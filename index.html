<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>YouTube Music Player</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        background: #0f0f0f;
        color: #fff;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, sans-serif;
      }

      /* Center container */
      .center {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .controls {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
      }

      /* Play/Pause button */
      .play-btn {
        width: 88px;
        height: 88px;
        border-radius: 50%;
        border: none;
        background: rgba(255, 255, 255, 0.12);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4) inset,
          0 4px 24px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(4px);
        display: grid;
        place-items: center;
        cursor: pointer;
        transition: transform 0.18s ease, background 0.2s ease;
      }
      .play-btn:hover {
        transform: scale(1.04);
        background: rgba(255, 255, 255, 0.18);
      }
      .play-btn:active {
        transform: scale(0.98);
      }

      /* Icon states */
      .play-icon,
      .pause-icon {
        pointer-events: none;
      }
      .play-icon {
        margin-left: 4px;
        width: 0;
        height: 0;
        border-top: 14px solid transparent;
        border-bottom: 14px solid transparent;
        border-left: 22px solid #fff;
      }
      .pause-icon {
        display: none;
        grid-auto-flow: column;
        gap: 6px;
      }
      .pause-icon span {
        width: 6px;
        height: 28px;
        background: #fff;
        border-radius: 2px;
        display: block;
      }
      .is-playing .play-icon {
        display: none;
      }
      .is-playing .pause-icon {
        display: grid;
      }

      /* Volume slider */
      .volume {
        width: 260px;
        accent-color: #ffffff;
        cursor: pointer;
      }

      /* Disclaimer banner */
      .banner {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 10px 16px;
        background: rgba(255, 255, 255, 0.08);
        color: #eaeaea;
        text-align: center;
        font-size: 12px;
        border-top: 1px solid rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(6px);
      }
      .banner a {
        color: #fff;
        text-decoration: underline;
      }

      /* Hide the YouTube iframe visually while meeting min viewport (200x200) per docs */
      #player,
      #player iframe {
        position: absolute !important;
        width: 200px !important;
        height: 200px !important;
        opacity: 0 !important;
        pointer-events: none !important;
        overflow: hidden !important;
        left: -10000px !important;
        top: auto !important;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>
  <body>
    <!-- Hidden YouTube player container -->
    <div id="player" aria-hidden="true"></div>

    <!-- Centered play/pause control -->
    <div class="center">
      <div class="controls">
        <button
          id="toggle"
          class="play-btn"
          aria-pressed="false"
          aria-label="Play"
        >
          <div class="play-icon" aria-hidden="true"></div>
          <div class="pause-icon" aria-hidden="true">
            <span></span><span></span>
          </div>
        </button>
        <label for="volume" class="sr-only">Volume</label>
        <input
          id="volume"
          class="volume"
          type="range"
          min="0"
          max="100"
          step="1"
          value="100"
        />
      </div>
    </div>

    <div class="banner" role="contentinfo">
      This site is just a YouTube mirror to the stream of Lofi Girl. Watch on
      <a
        href="https://www.youtube.com/watch?v=jfKfPfyJRdk"
        target="_blank"
        rel="noopener noreferrer"
        >YouTube</a
      >.
    </div>

    <script>
      let volume = 100;

      // Load the YouTube Iframe API
      (function loadYouTubeAPI() {
        var tag = document.createElement("script");
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName("script")[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      })();

      var ytPlayer;
      var isPlaying = false;
      var toggleBtn;
      var volumeSlider;

      // Called by the YouTube Iframe API when it's ready
      function onYouTubeIframeAPIReady() {
        toggleBtn = document.getElementById("toggle");
        volumeSlider = document.getElementById("volume");
        ytPlayer = new YT.Player("player", {
          videoId: "jfKfPfyJRdk",
          playerVars: {
            autoplay: 1, // attempt autoplay
            controls: 0,
            disablekb: 1,
            fs: 0,
            rel: 0,
            modestbranding: 1,
            playsinline: 1,
            // Start muted to satisfy autoplay policies
            mute: 1,
          },
          events: {
            onReady: function () {
              // Autoplay policies typically require muted playback without user gesture
              ensureIframePermissions();
              try {
                ytPlayer.mute();
              } catch (e) {}
            },
            onStateChange: function (event) {
              if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                updateUI(true);
              } else if (
                event.data === YT.PlayerState.PAUSED ||
                event.data === YT.PlayerState.ENDED
              ) {
                isPlaying = false;
                updateUI(false);
              }
            },
          },
        });

        // Toggle via click
        toggleBtn.addEventListener("click", function () {
          if (!ytPlayer) return;
          var state = ytPlayer.getPlayerState();
          var muted = false;
          try {
            muted = ytPlayer.isMuted();
          } catch (e) {}
          if (state === YT.PlayerState.PLAYING) {
            if (muted) {
              try {
                ytPlayer.unMute();
                ytPlayer.setVolume(volume);
              } catch (e) {}
            } else {
              ytPlayer.pauseVideo();
            }
          } else {
            try {
              ytPlayer.unMute();
              ytPlayer.setVolume(100);
            } catch (e) {}
            ytPlayer.playVideo();
          }
        });

        // Volume control
        if (volumeSlider) {
          volumeSlider.addEventListener("input", function () {
            if (!ytPlayer) return;
            var v = parseInt(volumeSlider.value, 10);
            v = isNaN(v) ? 100 : Math.max(0, Math.min(100, v));
            volume = v;
            try {
              if (v === 0) {
                ytPlayer.setVolume(0);
                ytPlayer.mute();
              } else {
                ytPlayer.setVolume(v);
                ytPlayer.unMute();
              }
            } catch (e) {}
          });
        }

        // Toggle via Space key (when focus not in an input)
        window.addEventListener("keydown", function (ev) {
          var tag =
            (document.activeElement && document.activeElement.tagName) || "";
          if (ev.code === "Space" && !/^(INPUT|TEXTAREA|SELECT)$/.test(tag)) {
            ev.preventDefault();
            toggleBtn.click();
          }
        });
      }

      function updateUI(playing) {
        if (!toggleBtn) return;
        toggleBtn.classList.toggle("is-playing", playing);
        toggleBtn.setAttribute("aria-pressed", String(playing));
        toggleBtn.setAttribute("aria-label", playing ? "Pause" : "Play");
      }

      // Ensure the injected iframe has an explicit allow attribute for features it uses
      function ensureIframePermissions() {
        try {
          if (!ytPlayer || !ytPlayer.getIframe) return;
          var iframe = ytPlayer.getIframe();
          if (!iframe) return;
          var current = (iframe.getAttribute("allow") || "")
            .split(";")
            .map(function (s) {
              return s.trim();
            })
            .filter(Boolean);
          var required = ["autoplay", "encrypted-media", "picture-in-picture"];
          var set = {};
          current.forEach(function (f) {
            set[f] = true;
          });
          required.forEach(function (f) {
            set[f] = true;
          });
          var merged = Object.keys(set).join("; ");
          iframe.setAttribute("allow", merged);
        } catch (e) {
          // no-op
        }
      }
    </script>
  </body>
</html>
